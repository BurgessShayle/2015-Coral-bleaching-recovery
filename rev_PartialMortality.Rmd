
---
title: "ColorScore revision"
author: "Shayle Matsuda"
date: "9/25/2019"
output:
  pdf_document:
    keep_tex: yes
  html_document:
    code_folding: hide
    toc: yes
    toc_depth: 6
    toc_float: yes
editor_options: 
  chunk_output_type: console
---
Tissue partial mortality in *M. capitata* and *P. compressa* colonies at the Inner Lagoon (PR4) and Outer Lagoon (PR13) after the 2015 coral bleaching event in Kaneohe Bay.  Mortality scores are in % to the nearest 20%

```{r setup, include=FALSE,results="hide"}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, results="hide", message=FALSE}
#rm(list=ls(all=TRUE)) 
library("reshape2") #reshape data
library("plotrix") #functions in tapply
library("ggplot2") #plotting
library("reshape") #reshape data
library("plyr")  #splitting, applying, and combining data
library("dplyr")  #splitting, applying, and combining data
library("pscl")
library("plotrix") #plotting
library("gridExtra") #arrange plots for output
library("car") #levenes test
library("lsmeans")
library(effects)
library("multcomp") 
library("multcompView")
library("coefplot") #coefficient plotting
library("seacarb") #seawater carbonate chemistry
library("vegan") #calculating distance matrices
library(betareg)
library(coin)
library(exactRankTests)
library(mvtnorm)
library(DTK)
library(PMCMR)
library(MuMIn)
library(glmmTMB)
library(lme4)
library(lmerTest)
library(ggsignif)
library(HH)
library(PMCMR)
library(tidyverse)
library(arm)
library(jtools)
library(broom)
library(ggstance)
library(officer)
library(huxtable)
library(flextable)

#load data
mData<-read.csv("DECIMALmortality_scores_percent_20191110_missingdataremoved.csv")
mData$Site<-as.factor(mData$Site)

#We excluded these pairs as part of the pair analysis because the Bleached coral was only a 2: Porites Outer Bay 233_234, Porites Inner Bay 297_298, Porites Outer Bay 227_228, Montipora capitata Inner Bay 251_252.
```

# Partial mortality rate  
Time points: 0-3 months,0-6 months
```{r,results="hide", }
#all Months
  mALL<-mData
  #melt
  mALLData1<-melt(data = mALL, measure.vars = c("Month0","Month1.5","Month3","Month4.5", "Month6","Month10","Month18","Month24"))   
  colnames(mALLData1)[colnames(mALLData1)=="variable"] <- "month"   # change col name from 'variable' to 'month'
  colnames(mALLData1)[colnames(mALLData1)=="value"] <- "score"   # change col name from 'value' to 'score'

#Remove all NON PAIRS and all NAs
  mALLData<-na.omit(mALLData1) # remove the NA colums

  #Change scores into %
mALLDataPER<-mALLData
mALLDataPER$Score<-mALLDataPER$score*100

#recast for rate cals
mALLData_cast<-dcast(mALLData, TagID+Pair+Species+Site+B2015~month)

```

Mean partial mortality scores
```{r, results=TRUE}
#calc average tissue loss score per grouping by time point
mALLmeans <- ddply(mALLData, c("Site", "Species", "B2015", "month"), summarise, #
                   N    = length(score[!is.na(score)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(score, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(score, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(score, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
mALLmeans$code<-paste0(mALLmeans$Site, mALLmeans$B2015, mALLmeans$Species)
#mALLmeans #display table
```

## Partial mortality score means 0-24 months by species/site/bleaching history
For paper figure, as percents
```{r, results=TRUE}


#calc average tissue loss score per grouping by time point
mALLmeansPER <- ddply(mALLDataPER, c("Site", "Species", "B2015", "month"), summarise, #
                   N    = length(Score[!is.na(Score)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Score, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Score, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Score, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
#mALLmeansPER #display table
mALLmeansPER$code<-paste0(mALLmeansPER$Site, mALLmeansPER$B2015, mALLmeansPER$Species)
#mALLmeansPER #display table
```

###*Montipora capitata*: Partial mortality
Figure 5
```{r}
#subset for Mcap only
Mcap024AllplotM<-subset(mALLmeansPER, Species=="Montipora capitata")     #subset Mcap
Mcap024AllplotM$Month[Mcap024AllplotM$month=="Month0"]<-0              # new col with month #s only
Mcap024AllplotM$Month[Mcap024AllplotM$month=="Month1.5"]<-1.5  
Mcap024AllplotM$Month[Mcap024AllplotM$month=="Month3"]<-3 
Mcap024AllplotM$Month[Mcap024AllplotM$month=="Month4.5"]<-4.5
Mcap024AllplotM$Month[Mcap024AllplotM$month=="Month6"]<-6  
Mcap024AllplotM$Month[Mcap024AllplotM$month=="Month10"]<-10  
Mcap024AllplotM$Month[Mcap024AllplotM$month=="Month18"]<-18
Mcap024AllplotM$Month[Mcap024AllplotM$month=="Month24"]<-24 


#PR13
Mcap024AllplotPR13M<-subset(Mcap024AllplotM, Site==13)
#PR4
Mcap024AllplotPR4M<-subset(Mcap024AllplotM, Site==4)
```

Mcap PR13
```{r}
mallplotMcapPR13<-ggplot(data=Mcap024AllplotPR13, aes(x=Month, y=mean, group = code, color=B2015)) + #color by bleaching hist. 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1,show.legend = FALSE)+
  geom_point(aes(shape=B2015),fill="mediumblue", size=3)+
  scale_shape_manual(values=c( 16,1))+
  geom_line(aes(color=B2015, linetype=B2015))+
  scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("black","black"))+
    scale_x_continuous(breaks = seq(0, 24, by = 6))+
  ylab("Partial Mortality (%)") +
    xlab("Recovery Time (months)") + #Label the X Axis
    ylim(0, 80) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ggtitle("Outer Lagoon")+
          theme(plot.title = element_text(size=20,face = "bold",hjust = 0.5));mallplotMcapPR13
McapOuter<-mallplotMcapPR13 + theme(legend.position = "none") #remove legend
```

Mcap PR4
```{r}
ballplotMcapPR4M<-ggplot(data=Mcap024AllplotPR4M, aes(x=Month, y=mean, group = code, color=B2015),show.legend = FALSE) + #color by bleaching hist. 
 geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1,show.legend = FALSE)+
  geom_point(aes(shape=B2015),fill="mediumblue", size=3)+
  
  scale_shape_manual(values=c( 16,1))+
  
  geom_line(aes(color=B2015, linetype=B2015))+
  scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("black","black"))+
    scale_x_continuous(breaks = seq(0, 24, by = 6))+
  ylab("Montipora capitata\nParital Mortality (%)") +
    xlab("Recovery Time (months)") + #Label the X Axis
    ylim(0, 80) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ggtitle("Inner Lagoon")+
          theme(plot.title = element_text(size=20,face = "bold", hjust = 0.5));ballplotMcapPR4M
McapInnerMORT<-ballplotMcapPR4M + theme(legend.position = "none") #remove legend
McapInnerMORT
```

###*Porites compressa*  
Figure 5
```{r}
Pcomp024Allplot<-subset(mALLmeansPER, Species=="Porites compressa")

# change Month# to just number
Pcomp024Allplot$Month[Pcomp024Allplot$month=="Month0"]<-0
Pcomp024Allplot$Month[Pcomp024Allplot$month=="Month1.5"]<-1.5
Pcomp024Allplot$Month[Pcomp024Allplot$month=="Month3"]<-3
Pcomp024Allplot$Month[Pcomp024Allplot$month=="Month4.5"]<-4.5
Pcomp024Allplot$Month[Pcomp024Allplot$month=="Month6"]<-6
Pcomp024Allplot$Month[Pcomp024Allplot$month=="Month10"]<-10
Pcomp024Allplot$Month[Pcomp024Allplot$month=="Month18"]<-18
Pcomp024Allplot$Month[Pcomp024Allplot$month=="Month24"]<-24

Pcomp024AllplotPR13<-subset(Pcomp024Allplot, Site==13)
Pcomp024AllplotPR4<-subset(Pcomp024Allplot, Site==4)
```

Pcomp PR13
```{r}
b024plotPcompPR13<-ggplot(data=Pcomp024AllplotPR13, aes(x=Month, y=mean, group = code, color=B2015)) + #color by bleaching hist. 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1,show.legend = FALSE)+
  geom_point(aes(shape=B2015),fill="mediumblue", size=3)+
  scale_shape_manual(values=c( 16,1))+
  geom_line(aes(color=B2015, linetype=B2015))+
  scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("black","black"))+
    scale_x_continuous(breaks = seq(0, 24, by = 6))+
  ylab("Partial Mortality (%)") +
    xlab("Recovery Time (months)") + #Label the X Axis
    ylim(0,80) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  #ggtitle("Porites compressa Bleaching Scores months 0-24")+
          theme(plot.title = element_text(size=20,face = "italic"));b024plotPcompPR13
PcompOuter<-b024plotPcompPR13+ theme(legend.position = "none") #remove legend
```

Pcomp PR4
```{r}
b024plotPcompPR4<-ggplot(data=Pcomp024AllplotPR4, aes(x=Month, y=mean, group = code, color=B2015)) + #color by bleaching hist. 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1,show.legend = FALSE)+
  geom_point(aes(shape=B2015),fill="mediumblue", size=3)+
  
  scale_shape_manual(values=c( 16,1))+
  
  geom_line(aes(color=B2015, linetype=B2015))+
  scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("black","black"))+
    scale_x_continuous(breaks = seq(0, 24, by = 6))+
  ylab("Porites compressa\nPartial Mortality (%)") +
    xlab("Recovery Time (months)") + #Label the X Axis
    ylim(0,80) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  #ggtitle("Porites compressa Bleaching Scores months 0-24")+
          theme(plot.title = element_text(size=20,face = "italic"));b024plotPcompPR4
PcompInner<-b024plotPcompPR4+ theme(legend.position = "none") #remove legend
PcompInner
```

Plot all four together: Figure 5
```{r}
grid.arrange(McapInner, McapOuter, PcompInner,PcompOuter, nrow = 2)
```


Table 3: Full dataset
Mortality 0-3 months and 0-6 months
score~month*B2015*lagoon

Set up dateframes
```{r}
#subset by species
Mcap_mort<-subset(mALLDataPER, Species=="Montipora capitata")
Pcomp_mort<-subset(mALLDataPER, Species=="Porites compressa")
```

Table 3
Mortality across all timepoints, Mcap and Pcomp
```{r}
#Mcap
Mcap_mort_mod<-lmer(Score~Site*B2015*month+(1|TagID), Mcap_mort)
anova(Mcap_mort_mod)

#conduct Tukey post hoc test 
emm = emmeans(Mcap_mort_mod, ~ Site*B2015*month, adjust="tukey")
#letter display
cld(emm)
 
#Pcomp
Pcomp_mort_mod<-lmer(Score~Site*B2015*month+(1|TagID), Pcomp_mort)
anova(Pcomp_mort_mod)

#conduct Tukey post hoc test 
emm = emmeans(Pcomp_mort_mod, ~ Site*B2015*month, adjust="tukey")
#letter display
cld(emm)
```

# Partial mortality RATE - 
Mean partial mortality rate for all time points 
## 0-3 Months RATE calculation
df: mALLData_cast
Mcap rate
```{r} 
#Mcap
Mcap_rate<-subset(mALLData_cast, Species=="Montipora capitata")
Mcap_rate_03<-Mcap_rate[,c(1,2,4:6,8)] # months 0-3,select cols
Mcap_rate_03$Rate<-(((Mcap_rate_03$Month3-Mcap_rate_03$Month0))) #cal rate for 3 months
Mcap_rate_03<-na.omit(Mcap_rate_03) #get rid of NAs

Mcap_rate_36<-Mcap_rate[,c(1,2,4:5,8,10)] # months 3-6,select cols
Mcap_rate_36$Rate<-(((Mcap_rate_36$Month6-Mcap_rate_36$Month3))) #cal rate for next 3 months
Mcap_rate_36<-na.omit(Mcap_rate_36) #get rid of NAs

#Average the means of the rates. 
# calc average  tissue loss rate/month in %  per grouping
m03means <- ddply(Mcap_rate_03, c("Site", "B2015"), summarise, 
                   N    = length(Rate[!is.na(Rate)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Rate, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Rate, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Rate, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
#m03means #display table

m03means$code<-paste0(m03means$Site, m03means$B2015)
m03means #display table 

## 2. months 3-6
# means of the rates. 
# calc average  tissue loss rate/month in %  per grouping
m36means <- ddply(Mcap_rate_36, c("Site", "B2015"), summarise, 
                   N    = length(Rate[!is.na(Rate)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Rate, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Rate, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Rate, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
#m36means #display table

m36means$code<-paste0(m36means$Site, m36means$B2015, m36means$Species)
m36means #display table
```
Pcomp rate
```{r}
#Pcomp
Pcomp_rate<-subset(mALLData_cast, Species=="Porites compressa")
Pcomp_rate_03<-Pcomp_rate[,c(1,2,4:6,8)] # months 0-3,select cols
Pcomp_rate_03$Rate<-(((Pcomp_rate_03$Month3-Pcomp_rate_03$Month0))) #cal rate for 3 months
Pcomp_rate_03<-na.omit(Pcomp_rate_03) #get rid of NAs

Pcomp_rate_36<-Pcomp_rate[,c(1,2,4:5,8,10)] # months 3-6,select cols
Pcomp_rate_36$Rate<-(((Pcomp_rate_36$Month6-Pcomp_rate_36$Month3))) #cal rate for next 3 months
Pcomp_rate_36<-na.omit(Pcomp_rate_36) #get rid of NAs

#Average the means of the rates. 
# calc average  tissue loss rate/month in %  per grouping
p03means <- ddply(Pcomp_rate_03, c("Site", "B2015"), summarise, 
                   N    = length(Rate[!is.na(Rate)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Rate, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Rate, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Rate, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
#p03means #display table

p03means$code<-paste0(p03means$Site, p03means$B2015)
p03means #display table 

## 2. months 3-6
# means of the rates. 
# calc average  tissue loss rate/month in %  per grouping
p36means <- ddply(Pcomp_rate_36, c("Site", "B2015"), summarise, 
                   N    = length(Rate[!is.na(Rate)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Rate, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Rate, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Rate, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
#p36means #display table

p36means$code<-paste0(p36means$Site, p36means$B2015, p36means$Species)
p36means #display table
```


#Tissue Loss  Models  
SI Table 2 and SI Table 12.  
`Mortality Score ~ Reef Site * Bleaching History * Coral Species`  
 *Montipora capiatata*  
```{r}
  
#Month0 
Mcap_m0<-subset(Mcap_mort, month=="Month0")
Mcap_m0_mod1<-lm(score~Site*B2015, Mcap_m0)
summary(Mcap_m0_mod1) 

# Month1.5
Mcap_m1_5<-subset(Mcap_mort, month=="Month1.5")
Mcap_m1_5_mod1<-lm(score~Site*B2015, Mcap_m1_5)
summary(Mcap_m1_5_mod1)
    #conduct Tukey post hoc test 
    emm = emmeans(Mcap_m1_5_mod1, ~ B2015, adjust="tukey")
    #letter display
    cld(emm)

#Month3
Mcap_m3<-subset(Mcap_mort, month=="Month3")
Mcap_m3_mod1<-lm(score~Site*B2015, Mcap_m3)
summary(Mcap_m3_mod1)
  #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m3_mod1, ~ B2015, adjust="tukey") #B2015
      #letter display
      cld(emm)
      #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m3_mod1, ~ Site*B2015, adjust="tukey")  #B2015*Site
      #letter display
      cld(emm)

#Month4.5
Mcap_m4_5<-subset(Mcap_mort, month=="Month4.5")
Mcap_m4_5_mod1<-lm(score~Site*B2015, Mcap_m4_5)
summary(Mcap_m4_5_mod1)

 #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m4_5_mod1, ~ B2015, adjust="tukey") #B2015
      #letter display
      cld(emm)
      #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m4_5_mod1, ~ Site, adjust="tukey")  #Site
      #letter display
      cld(emm)
      
#Month6
Mcap_m6<-subset(Mcap_mort, month=="Month6")
Mcap_m6_mod1<-lm(score~Site*B2015, Mcap_m6)
summary(Mcap_m6_mod1)
  #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m6_mod1, ~ B2015, adjust="tukey") #B2015
      #letter display
      cld(emm)
      #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m6_mod1, ~ Site, adjust="tukey")  #Site
      #letter display
      cld(emm)
      
#Month10
Mcap_m10<-subset(Mcap_mort, month=="Month10")
Mcap_m10_mod1<-lm(score~Site*B2015, Mcap_m10)
summary(Mcap_m10_mod1)
  #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m10_mod1, ~ B2015, adjust="tukey") #B2015
      #letter display
      cld(emm)
      #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m10_mod1, ~ Site, adjust="tukey")  #Site
      #letter display
      cld(emm)
      
#Month18
Mcap_m18<-subset(Mcap_mort, month=="Month18")
Mcap_m18_mod1<-lm(score~Site*B2015, Mcap_m18)
summary(Mcap_m18_mod1)
      #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m18_mod1, ~ Site, adjust="tukey")  #Site
      #letter display
      cld(emm)
      
#Month24
Mcap_m24<-subset(Mcap_mort, month=="Month24")
Mcap_m24_mod1<-lm(score~Site*B2015, Mcap_m24)
summary(Mcap_m24_mod1)
      #conduct Tukey post hoc test 
      emm = emmeans(Mcap_m24_mod1, ~ Site, adjust="tukey")  #Site
      #letter display
      cld(emm)
```

*Porites compressa*  mixed model
SI Table 2 and SI Table 12
```{r}
 
#Month0
Pcomp_m0<-subset(Pcomp_mort, month=="Month0")
Pcomp_m0_mod1<-lm(score~Site*B2015, Pcomp_m0)
summary(Pcomp_m0_mod1) 
#conduct Tukey post hoc test 
emm = emmeans(Pcomp_m0_mod1, ~ Site*B2015, adjust="tukey")
#letter display
cld(emm)

# Month1.5
Pcomp_m1_5<-subset(Pcomp_mort, month=="Month1.5")
Pcomp_m1_5_mod1<-lm(score~Site*B2015, Pcomp_m1_5)
summary(Pcomp_m1_5_mod1)
#conduct Tukey post hoc test 
emm = emmeans(Pcomp_m1_5_mod1, ~ Site*B2015, adjust="tukey")
#letter display
cld(emm)

#Month3
Pcomp_m3<-subset(Pcomp_mort, month=="Month3")
Pcomp_m3_mod1<-lm(score~Site*B2015, Pcomp_m3)
summary(Pcomp_m3_mod1)
#conduct Tukey post hoc test 
emm = emmeans(Pcomp_m3_mod1, ~ Site*B2015, adjust="tukey")
#letter display
cld(emm)

#Month4.5
Pcomp_m4_5<-subset(Pcomp_mort, month=="Month4.5")
Pcomp_m4_5_mod1<-lm(score~Site*B2015, Pcomp_m4_5)
summary(Pcomp_m4_5_mod1)
#conduct Tukey post hoc test 
emm = emmeans(Pcomp_m4_5_mod1, ~ B2015, adjust="tukey")
#letter display
cld(emm)

#Month6
Pcomp_m6<-subset(Pcomp_mort, month=="Month6")
Pcomp_m6_mod1<-lm(score~Site*B2015, Pcomp_m6)
summary(Pcomp_m6_mod1)

#Month10
Pcomp_m10<-subset(Pcomp_mort, month=="Month10")
Pcomp_m10_mod1<-lm(score~Site*B2015, Pcomp_m10)
summary(Pcomp_m10_mod1)
#conduct Tukey post hoc test 
emm = emmeans(Pcomp_m10_mod1, ~ B2015, adjust="tukey")
#letter display
cld(emm)

#Month18
Pcomp_m18<-subset(Pcomp_mort, month=="Month18")
Pcomp_m18_mod1<-lm(score~Site*B2015, Pcomp_m18)
summary(Pcomp_m18_mod1)

#Month24
Pcomp_m24<-subset(Pcomp_mort, month=="Month24")
Pcomp_m24_mod1<-lm(score~Site*B2015, Pcomp_m24)
summary(Pcomp_m24_mod1)
#conduct Tukey post hoc test 
emm = emmeans(Pcomp_m24_mod1, ~ B2015, adjust="tukey")
#letter display
cld(emm)
```

# Partial mortality rates, by reef Site and Bleaching History  
SI Table 13  
*M. capitata* RATE
```{r}
#0-3 months
Mcap_m03rate<-lmer(Rate~Site*B2015+(1|Pair), Mcap_rate_03)
summary(Mcap_m03rate)
anova(Mcap_m03rate)
 #conduct Tukey post hoc test 
    emm = emmeans(Mcap_m03rate, ~ B2015, adjust="tukey")
    #letter display
    cld(emm)
    emm = emmeans(Mcap_m03rate, ~ Site, adjust="tukey")
    #letter display
    cld(emm)
    emm = emmeans(Mcap_m03rate, ~ B2015*Site, adjust="tukey")
    #letter display
    cld(emm)

#3-6 months
Mcap_m36rate<-lmer(Rate~Site*B2015+(1|Pair), Mcap_rate_36)
summary(Mcap_m36rate)
anova(Mcap_m36rate)
 #conduct Tukey post hoc test 
    emm = emmeans(Mcap_m36rate, ~ Site, adjust="tukey")
    #letter display
    cld(emm)
 
```

*Porites compressa only*
SI Table 13   RATE
```{r}
#0-3 months
Pcomp_m03rate<-lmer(Rate~Site*B2015+(1|Pair), Pcomp_rate_03)
summary(Pcomp_m03rate)
anova(Pcomp_m03rate)

#3-6 months
Pcomp_m36rate<-lmer(Rate~Site*B2015+(1|Pair), Pcomp_rate_36)
summary(Pcomp_m36rate)
anova(Pcomp_m36rate)
 #conduct Tukey post hoc test 
    emm = emmeans(Pcomp_m36rate, ~ Site*B2015, adjust="tukey")
    #letter display
    cld(emm)
 
```

# Pairs comparison   
(only include colonies when both partners of a pair are found)
df: mALLDataPER
```{r,results="hide"}
#Figure out which of the pairs we lose 
#dataset to work from (pull unwanted from)
pData<-mALLDataPER

#subset by month
M0<-subset(pData,month=="Month0")
M1.5<-subset(pData,month=="Month1.5")
M3<-subset(pData,month=="Month3")
M4.5<-subset(pData,month=="Month4.5")
M6<-subset(pData,month=="Month6")
M10<-subset(pData,month=="Month10")
M18<-subset(pData,month=="Month18")
M24<-subset(pData,month=="Month24")


# Identify which pairs have a partner not found
# month 0
 M0diff<-M0 
  M0diff<-dcast(M0diff, Species+Site+Pair+month~B2015) # cast()
  M0diff$diff<-M0diff$N-M0diff$Y

# Subset Month1.5 
  M1.5<-M1.5[!(M1.5$Pair=="113_114"),]
 #DIFFS
  M1.5diff<-M1.5  
  M1.5diff<-dcast(M1.5diff, Species+Site+Pair+month~B2015) # cast()
  M1.5diff$diff<-M1.5diff$N-M1.5diff$Y
  
## Subset Month3
  # remove 
  M3<-M3[!(M3$Pair=="7_8"),]
  M3<-M3[!(M3$Pair=="113_114"),]
  M3<-M3[!(M3$Pair=="255_256"),]
  M3<-M3[!(M3$Pair=="259_260"),]
  #DIFFS
  M3diff<-M3  
  M3diff<-dcast(M3diff, Species+Site+Pair+month~B2015) # cast()
  M3diff$diff<-M3diff$N-M3diff$Y

## Subset Month 4.5
  # remove 
  M4.5<-M4.5[!(M4.5$Pair=="7_8"),]
  M4.5<-M4.5[!(M4.5$Pair=="113_114"),]
  M4.5<-M4.5[!(M4.5$Pair=="255_256"),]
  M4.5<-M4.5[!(M4.5$Pair=="259_260"),]
  M4.5<-M4.5[!(M4.5$Pair=="263_264"),]
  M4.5<-M4.5[!(M4.5$Pair=="267_268"),]
  M4.5<-M4.5[!(M4.5$Pair=="82_83"),]
 #DIFFS
  M4.5diff<-M4.5  
  M4.5diff<-dcast(M4.5diff, Species+Site+Pair+month~B2015) # cast()
  M4.5diff$diff<-M4.5diff$N-M4.5diff$Y

# Subset month 6
  # remove 
  M6<-M6[!(M6$Pair=="111_112"),] # remove the other partner
  M6<-M6[!(M6$Pair=="115_116"),]
  M6<-M6[!(M6$Pair=="119_120"),]
  M6<-M6[!(M6$Pair=="207_208"),]
  M6<-M6[!(M6$Pair=="255_256"),]
  M6<-M6[!(M6$Pair=="259_260"),]
  M6<-M6[!(M6$Pair=="263_264"),]
  M6<-M6[!(M6$Pair=="267_268"),]
  M6<-M6[!(M6$Pair=="263_264"),]
  #DIFFS
  M6diff<-M6  
  M6diff<-dcast(M6diff, Species+Site+Pair+month~B2015) # cast()
  M6diff$diff<-M6diff$N-M6diff$Y

  # Subset month 10
  #M10<-na.omit(M10) # remove the NA colums
  # remove 253_254, 259_260, 161_262, 263_264, 267_268, 271_272, 273_274, 275_276,277_278 , 31_2
  M10<-M10[!(M10$Pair=="253_254"),] # remove the other partner
  M10<-M10[!(M10$Pair=="259_260"),]
  M10<-M10[!(M10$Pair=="113_114"),]
  M10<-M10[!(M10$Pair=="161_262"),]
  M10<-M10[!(M10$Pair=="263_264"),]
  M10<-M10[!(M10$Pair=="267_268"),]
  M10<-M10[!(M10$Pair=="271_272"),]
  M10<-M10[!(M10$Pair=="273_274"),]
  M10<-M10[!(M10$Pair=="275_276"),]
  M10<-M10[!(M10$Pair=="277_278"),]
  M10<-M10[!(M10$Pair=="31_32"),]
  M10<-M10[!(M10$Pair=="261_262"),]

  #DIFFS
  M10diff<-M10  
  M10diff<-dcast(M10diff, Species+Site+Pair+month~B2015) # cast()
  M10diff$diff<-M10diff$N-M10diff$Y
  
# Subset month 18
  M18<-M18[!(M18$Pair=="253_254"),] # remove the other partner
  M18<-M18[!(M18$Pair=="259_260"),]
  M18<-M18[!(M18$Pair=="161_262"),]
  M18<-M18[!(M18$Pair=="263_264"),]
  M18<-M18[!(M18$Pair=="267_268"),]
  M18<-M18[!(M18$Pair=="271_272"),]
  M18<-M18[!(M18$Pair=="273_274"),]
  M18<-M18[!(M18$Pair=="275_276"),]
  M18<-M18[!(M18$Pair=="277_278"),]
  M18<-M18[!(M18$Pair=="31_2"),]
  M18<-M18[!(M18$Pair=="115_116"),]
  M18<-M18[!(M18$Pair=="119_120"),]
  M18<-M18[!(M18$Pair=="261_262"),]
  M18<-M18[!(M18$Pair=="269_270"),]
  M18<-M18[!(M18$Pair=="101_102"),]
  M18<-M18[!(M18$Pair=="117_118"),]
  M18<-M18[!(M18$Pair=="265_266"),]
  M18<-M18[!(M18$Pair=="19_20"),]
  M18<-M18[!(M18$Pair=="205_206"),]
  M18<-M18[!(M18$Pair=="223_224"),]
  M18<-M18[!(M18$Pair=="39_40"),]
    M18<-M18[!(M18$Pair=="103_104"),]

  #DIFFS
  M18diff<-M18  
  M18diff<-dcast(M18diff, Species+Site+Pair+month~B2015) # cast()
  M18diff$diff<-M18diff$N-M18diff$Y
  
  # Subset month 24
  M24<-M24[!(M24$Pair=="107_108"),] # remove the other partner
  M24<-M24[!(M24$Pair=="13_14"),]
  M24<-M24[!(M24$Pair=="223_224"),]
  M24<-M24[!(M24$Pair=="231_232"),]
  M24<-M24[!(M24$Pair=="261_262"),]
  M24<-M24[!(M24$Pair=="263_264"),]
  M24<-M24[!(M24$Pair=="265_266"),]
  M24<-M24[!(M24$Pair=="283_284"),]
  M24<-M24[!(M24$Pair=="289_290"),]
  M24<-M24[!(M24$Pair=="31_32"),]
  M24<-M24[!(M24$Pair=="33_34"),]
  M24<-M24[!(M24$Pair=="39_40"),]
  M24<-M24[!(M24$Pair=="76_77"),]
  M24<-M24[!(M24$Pair=="78_79"),]
  #DIFFS
  M24diff<-M24  
  M24diff<-dcast(M24diff, Species+Site+Pair+month~B2015) # cast()
  M24diff$diff<-M24diff$N-M24diff$Y
  
#make dfs  
PairDat<-rbind(M0,M1.5,M3,M4.5,M6,M10,M18,M24)
diffDat<-rbind(M0diff,M1.5diff,M3diff,M4.5diff,M6diff,M10diff,M18diff,M24diff)



#Mean bleaching scores across the entire project

#calc average bleaching score per grouping by time point
pairmeans <- ddply(PairDat, c("Site", "Species", "B2015", "month"), summarise, #
                   N    = length(score[!is.na(score)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(score, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(score, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(score, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
#ballmeans #display table

pairmeans$code<-paste0(pairmeans$Site, pairmeans$B2015, pairmeans$Species)
pairmeans #display table

```


SI Table 2:
*M. capitata* partial mortality, pairs
lm() and lmer()
```{r}
#set up Pairs data
Mcappig<-subset(PairDat, Species =="Montipora capitata")            
 
#All
MpigPair_all_mod1<-lmer(score~Site*B2015*month+(1|TagID), Mcappig) #if we add in (1|Pair) we get failure to converge
summary(MpigPair_all_mod1)
anova(MpigPair_all_mod1)

#Month0
MpigPair0<-subset(Mcappig, month =="Month0")           
MpigPair0_mod1<-lm(score~Site*B2015, MpigPair0)
summary(MpigPair0_mod1)

#Month1.5
MpigPair1.5<-subset(Mcappig, month =="Month1.5")
MpigPair1.5_mod1<-lm(score~Site*B2015, MpigPair1.5)
summary(MpigPair1.5_mod1)

#Month3
MpigPair3<-subset(Mcappig, month =="Month3")
MpigPair3_mod1<-lm(score~Site*B2015, MpigPair3)
summary(MpigPair3_mod1)

#Month4.5
MpigPair4.5<-subset(Mcappig, month =="Month4.5")
MpigPair4.5_mod1<-lm(score~Site*B2015, MpigPair4.5)
summary(MpigPair4.5_mod1)

#Month6
MpigPair6<-subset(Mcappig, month =="Month6")
MpigPair6_mod1<-lm(score~Site*B2015, MpigPair6)
summary(MpigPair6_mod1)

#Month10
MpigPair10<-subset(Mcappig, month =="Month10")
MpigPair10_mod1<-lm(score~Site*B2015, MpigPair10)
summary(MpigPair10_mod1)

#Month18
MpigPair18<-subset(Mcappig, month =="Month18")
# anova
MpigPair18_mod1<-lm(score~Site*B2015, MpigPair18)
summary(MpigPair18_mod1)

#Month24
MpigPair24<-subset(Mcappig, month =="Month24")
# anova
MpigPair24_mod1<-lm(score~Site*B2015, MpigPair24)
summary(MpigPair24_mod1)
```



SI Table 2  
*P. compressa* partial mortality pairs  
Model: `score~Site*B2015`  
```{r}
#set up Pairs data
Pcomppig<-subset(PairDat, Species =="Porites compressa")            

#All
PpigPair_all_mod1<-lmer(score~Site*B2015*month+(1|TagID), Pcomppig) #if we add in (1|Pair) we get failure to converge
summary(PpigPair_all_mod1)
anova(PpigPair_all_mod1)

#Month0
PpigPair0<-subset(Pcomppig, month =="Month0")           
PpigPair0_mod1<-lm(score~Site*B2015, PpigPair0)
summary(PpigPair0_mod1)

#Month1.5
PpigPair1.5<-subset(Pcomppig, month =="Month1.5")
PpigPair1.5_mod1<-lm(score~Site*B2015, PpigPair1.5)
summary(PpigPair1.5_mod1)

#Month3
PpigPair3<-subset(Pcomppig, month =="Month3")
PpigPair3_mod1<-lm(score~Site*B2015, PpigPair3)
summary(PpigPair3_mod1)

#Month4.5
PpigPair4.5<-subset(Pcomppig, month =="Month4.5")
PpigPair4.5_mod1<-lm(score~Site*B2015, PpigPair4.5)
summary(PpigPair4.5_mod1)

#Month6
PpigPair6<-subset(Pcomppig, month =="Month6")
PpigPair6_mod1<-lm(score~Site*B2015, PpigPair6)
summary(PpigPair6_mod1)

#Month10
PpigPair10<-subset(Pcomppig, month =="Month10")
PpigPair10_mod1<-lm(score~Site*B2015, PpigPair10)
summary(PpigPair10_mod1)

#Month18
PpigPair18<-subset(Pcomppig, month =="Month18")
# anova
PpigPair18_mod1<-lm(score~Site*B2015, PpigPair18)
summary(PpigPair18_mod1)

#Month24
PpigPair24<-subset(Pcomppig, month =="Month24")
# anova
PpigPair24_mod1<-lm(score~Site*B2015, PpigPair24)
summary(PpigPair24_mod1)
```

#Table 3: DIFFS
Pairs data
Partial mortalityall months
score~month*B2015*lagoon
*M. capitata* Pairs
df Mcappig
# DIFF DATA
Differences (nonbleached-bleached) for pairs
df: diffDat
Mean bleaching scores across the entire project
```{r, results=TRUE}
#calc average bleaching score per grouping by time point
diffmeans <- ddply(All_diff, c("Site", "Species", "month"), summarise, #
                   N    = length(diff[!is.na(diff)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(diff, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(diff, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(diff, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
#ballmeans #display table

diffmeans$code<-paste0(diffmeans$Site, diffmeans$B2015, diffmeans$Species)
diffmeans #display table
```


Table 3:
*P. compressa* Pairs  - cut since we use full model? 
```{r}
Pcompmort03Pairs<-subset(MortPairs03, Species=="Porites compressa") 
Pcompmort06Pairs<-subset(MortPairs06, Species=="Porites compressa")
Pcompmort36Pairs<-subset(MortPairs36, Species=="Porites compressa")

#0-3 
Pcompmort03Pairs_mod<-aov(score~month*Site*B2015, Pcompmort03Pairs)
summary(Pcompmort03Pairs_mod)

#0-6
Pcompmort06Pairs_mod<-aov(score~month*Site*B2015, Pcompmort06Pairs)
summary(Pcompmort06Pairs_mod)
```


# Diffs data: pairs
dfs
```{r}
#subset the masterDiff
Mcap_diff<-subset(diffDat, Species=="Montipora capitata")
Mcap_diff<-na.omit(Mcap_diff)
Pcomp_diff<-subset(diffDat, Species=="Porites compressa")
Pcomp_diff<-na.omit(Pcomp_diff)

#full models
#Mcap

#All
MpigDiff_all_mod1<-lmer(diff~Site*month+(1|Pair), Mcap_diff) 
summary(MpigDiff_all_mod1)
anova(MpigDiff_all_mod1)

#Month0
MpigDiff0<-subset(Mcap_diff, month =="Month0")           
MpigDiff0_mod1<-lm(diff~Site, MpigDiff0)
summary(MpigDiff0_mod1)

#Month1.5
MpigDiff1.5<-subset(Mcap_diff, month =="Month1.5")           
MpigDiff1.5_mod1<-lm(diff~Site, MpigDiff1.5)
summary(MpigDiff1.5_mod1)

#Month3
MpigDiff3<-subset(Mcap_diff, month =="Month3")           
MpigDiff3_mod1<-lm(diff~Site, MpigDiff3)
summary(MpigDiff3_mod1)

#Month4.5
MpigDiff4.5<-subset(Mcap_diff, month =="Month4.5")           
MpigDiff4.5_mod1<-lm(diff~Site, MpigDiff4.5)
summary(MpigDiff4.5_mod1)

#Month6
MpigDiff6<-subset(Mcap_diff, month =="Month6")           
MpigDiff6_mod1<-lm(diff~Site, MpigDiff6)
summary(MpigDiff6_mod1)

#Month10
MpigDiff10<-subset(Mcap_diff, month =="Month10")           
MpigDiff10_mod1<-lm(diff~Site, MpigDiff10)
summary(MpigDiff10_mod1)

#Month18
MpigDiff18<-subset(Mcap_diff, month =="Month18")           
MpigDiff18_mod1<-lm(diff~Site, MpigDiff18)
summary(MpigDiff18_mod1)

#Month24
MpigDiff24<-subset(Mcap_diff, month =="Month24")           
MpigDiff24_mod1<-lm(diff~Site, MpigDiff24)
summary(MpigDiff24_mod1)

```

Pcomp diffs
```{r}
#subset the masterDiff
Pcomp_diff<-subset(diffDat, Species=="Porites compressa")
Pcomp_diff<-na.omit(Pcomp_diff)

#full models
#Pcomp

#All
PpigDiff_all_mod1<-lmer(diff~Site*month+(1|Pair), Pcomp_diff) 
summary(PpigDiff_all_mod1)
anova(PpigDiff_all_mod1)

#Month0
PpigDiff0<-subset(Pcomp_diff, month =="Month0")           
PpigDiff0_mod1<-lm(diff~Site, PpigDiff0)
summary(PpigDiff0_mod1)

#Month1.5
PpigDiff1.5<-subset(Pcomp_diff, month =="Month1.5")           
PpigDiff1.5_mod1<-lm(diff~Site, PpigDiff1.5)
summary(PpigDiff1.5_mod1)

#Month3
PpigDiff3<-subset(Pcomp_diff, month =="Month3")           
PpigDiff3_mod1<-lm(diff~Site, PpigDiff3)
summary(PpigDiff3_mod1)

#Month4.5
PpigDiff4.5<-subset(Pcomp_diff, month =="Month4.5")           
PpigDiff4.5_mod1<-lm(diff~Site, PpigDiff4.5)
summary(PpigDiff4.5_mod1)

#Month6
PpigDiff6<-subset(Pcomp_diff, month =="Month6")           
PpigDiff6_mod1<-lm(diff~Site, PpigDiff6)
summary(PpigDiff6_mod1)

#Month10
PpigDiff10<-subset(Pcomp_diff, month =="Month10")           
PpigDiff10_mod1<-lm(diff~Site, PpigDiff10)
summary(PpigDiff10_mod1)

#Month18
PpigDiff18<-subset(Pcomp_diff, month =="Month18")           
PpigDiff18_mod1<-lm(diff~Site, PpigDiff18)
summary(PpigDiff18_mod1)

#Month24
PpigDiff24<-subset(Pcomp_diff, month =="Month24")           
PpigDiff24_mod1<-lm(diff~Site, PpigDiff24)
summary(PpigDiff24_mod1)

```






Mean pairs mortality scores across the entire project
```{r, results=TRUE} 
#calc average bleaching score per grouping by time point
diffmeans <- ddply(diffDat, c("Site", "Species", "month"), summarise, #
                   N    = length(diff[!is.na(diff)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(diff, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(diff, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(diff, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
#ballmeans #display table

diffmeans$code<-paste0(diffmeans$Site, diffmeans$B2015, diffmeans$Species)
#diffmeans #display table
```

SI Figure 2:
*Montipora capitata* diffs Plot
```{r}
#subset for Mcap only
Mcapdiffplotb<-subset(diffmeans, Species=="Montipora capitata")

Mcapdiffplotc<-ggplot(data=Mcapdiffplotb, aes(x=month, y=mean, group = code, color=Site)) + #color by bleaching hist. 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1)+
  geom_point(aes(shape=Site), size=3)+
  geom_line(aes(color=Site, linetype=Site))+
  scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("black","black"))+
  ylab("Difference score") +
    xlab("") + #Label the X Axis
   #ylim(-.5, .5) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ggtitle("Montipora capitata")+
          theme(plot.title = element_text(size=20,face = "italic"));Mcapdiffplotc
Mcapdiffplotc<-Mcapdiffplotc + theme(legend.position = "none") #remove legend
Mcapdiffplotc
```

###Porites compressa diffs 
```{r}
#subset for Mcap only
Pcomdiffplotc<-subset(diffmeans, Species=="Porites compressa")


Pcompdiffplotd<-ggplot(data=Pcomdiffplotc, aes(x=month, y=mean, group = code, color=Site)) + #color by bleaching hist. 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1)+
  geom_point(aes(shape=Site), size=3)+
  geom_line(aes(color=Site, linetype=Site))+
  scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("black","black"))+
  ylab("Difference score") +
    xlab("") + #Label the X Axis
    ylim(-.5, .5) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ggtitle("Porites compressa")+
          theme(plot.title = element_text(size=20,face = "italic"));Pcompdiffplotd
Pcompdiffplotd<-Pcompdiffplotd + theme(legend.position = "none") #remove legend
Pcompdiffplotd
```

Plot all diffs plots together: SI Figure 2
```{r}
grid.arrange(Mcapdiffplotc, Pcompdiffplotd,Mcapdiffplotc, Pcompdiffplotd, nrow = 2)
```




Do we even keep this now?




SI Table 2: diff~Lagoon
*M. capitata*
```{r} 
#Month0
dMmortPair0<-subset(DiffData06, month =="Month0")           
dMmortPair0_mod1<-aov(diff~Site, dMmortPair0)
summary(dMmortPair0_mod1)

#Month1.5
dMmortPair1.5<-subset(DiffData06, month =="Month1.5")
dMmortPair1.5_mod1<-aov(diff~Site, dMmortPair1.5)
summary(dMmortPair1.5_mod1)

#Month3
dMmortPair3<-subset(DiffData06, month =="Month3")
dMmortPair3_mod1<-aov(diff~Site, dMmortPair3)
summary(dMmortPair3_mod1)

#Month4.5
dMmortPair4.5<-subset(DiffData06, month =="Month4.5")
dMmortPair4.5_mod1<-aov(diff~Site, dMmortPair4.5)
summary(dMmortPair4.5_mod1)

#month6
dMmortPair6<-subset(DiffData06, month =="Month6")
dMmortPair6_mod1<-aov(diff~Site, dMmortPair6)
summary(dMmortPair6_mod1)
```

SI Table 2: diff~Lagoon  <---- right
*P. compressa*
```{r} 
#Month0
dMmortPair0<-subset(DiffData06, month =="Month0")           
dMmortPair0_mod1<-aov(diff~Site, dMmortPair0)
summary(dMmortPair0_mod1)

#Month1.5
dMmortPair1.5<-subset(DiffData06, month =="Month1.5")
dMmortPair1.5_mod1<-aov(diff~Site, dMmortPair1.5)
summary(dMmortPair1.5_mod1)

#Month3
dMmortPair3<-subset(DiffData06, month =="Month3")
dMmortPair3_mod1<-aov(diff~Site, dMmortPair3)
summary(dMmortPair3_mod1)

#Month4.5
dMmortPair4.5<-subset(DiffData06, month =="Month4.5")
dMmortPair4.5_mod1<-aov(diff~Site, dMmortPair4.5)
summary(dMmortPair4.5_mod1)

#month6
dMmortPair6<-subset(DiffData06, month =="Month6")
dMmortPair6_mod1<-aov(diff~Site, dMmortPair6)
summary(dMmortPair6_mod1)
```

Table 3: diffs 03 months and 06 months
*M. capitat*
```{r}
DiffData03_Mcap<-subset(DiffData03, Species=="Montipora capitata")
DiffData06_Mcap<-subset(DiffData06, Species=="Montipora capitata")
DiffData36_Mcap<-subset(DiffData36, Species=="Montipora capitata")

# 0-3
d_Mcap03_mod1<-aov(diff~Site*month, DiffData03_Mcap)
summary(d_Mcap03_mod1)
TukeyHSD(d_Mcap03_mod1)

# 0-6
d_Mcap06_mod1<-aov(diff~Site*month, DiffData06_Mcap)
summary(d_Mcap06_mod1)
TukeyHSD(d_Mcap06_mod1)
```

Table 3: diffs 
*P. compressa*
```{r}
DiffData03_Pcomp<-subset(DiffData03, Species=="Porites compressa")
DiffData06_Pcomp<-subset(DiffData06, Species=="Porites compressa")
DiffData36_Pcomp<-subset(DiffData36, Species=="Porites compressa")

# 0-3
d_Pcomp03_mod1<-aov(diff~Site*month, DiffData03_Pcomp)
summary(d_Pcomp03_mod1)
TukeyHSD(d_Pcomp03_mod1)

# 0-6
d_Pcomp06_mod1<-aov(diff~Site*month, DiffData06_Pcomp)
summary(d_Pcomp06_mod1)
TukeyHSD(d_Pcomp06_mod1)
```

